<!DOCTYPE html>
<html lang="uk">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Оплата при отриманні — Autoparts‑UA</title>
<link rel="stylesheet" href="css/style.css">
<style>
.container{max-width:820px;margin:24px auto;padding:0 16px;}
.card{background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:20px}
.order-summary{border:1px dashed #cbd5e1;padding:12px;border-radius:6px;margin-top:12px}
.confirm-btn{background:#10b981;color:#fff;padding:12px 18px;border-radius:8px;border:none;font-weight:700;cursor:pointer}

.summary-box{
  border:1px solid #cbd5e1;
  border-radius:6px;
  padding:12px 16px;
  background:#f8fafc;
  margin-top:16px;
  font-size:14px;
  line-height:1.4;
}
.summary-row{
  display:flex;
  justify-content:space-between;
  border-bottom:1px solid #e2e8f0;
  padding:6px 0;
}
.summary-row:last-child{
  border-bottom:0;
}
.summary-head{
  font-weight:600;
  margin-top:20px;
  margin-bottom:8px;
  font-size:15px;
  color:#0f172a;
}
.item-list{
  border:1px solid #e2e8f0;
  border-radius:6px;
  background:#fff;
  padding:10px 12px;
  font-size:14px;
  line-height:1.4;
  max-height:200px;
  overflow-y:auto;
}
.item-line{
  display:flex;
  justify-content:space-between;
  gap:8px;
  border-bottom:1px solid #f1f5f9;
  padding:4px 0;
}
.item-left{
  font-weight:500;
  color:#0f172a;
}
.item-right{
  white-space:nowrap;
  color:#0f172a;
}
.total-line{
  font-weight:600;
  font-size:15px;
  text-align:right;
  margin-top:8px;
}
.warn{
  background:#fffceb;
  border:1px solid #d9be00;
  border-radius:4px;
  padding:10px 12px;
  font-size:14px;
  margin-top:16px;
  line-height:1.4;
}

</style>
  <script defer src="js/common-lang.js"></script>
</head>
<body>
<header class="header-topline" style="background:#0a1a3a;color:#fff;padding:12px 16px"><div style="font-weight:700">Autoparts‑UA</div><div style="font-size:12px;color:#cbd5e1">Оплата при отриманні</div></header>
<main class="container">
  <div class="card">
    <h2>Підтвердіть замовлення — оплата при отриманні</h2>
    
<div class="summary-head">Ваше замовлення</div>

<div id="orderInfo" class="summary-box">
  <div id="buyerInfo"></div>

  <div class="summary-head">Деталі замовлення</div>
  <div id="cartItems" class="item-list"></div>
  <div id="cartTotal" class="total-line"></div>

  <div class="warn">
    Оплата при отриманні.<br>
    Курʼєр на адресу: +100 грн<br>
    Відділення Нової Пошти: +40 грн<br>
    Ми узгодимо з вами точний варіант доставки по телефону / Viber перед відправкою.
  </div>
</div>

    <p style="margin-top:12px">Натисніть «Підтвердити замовлення», і ми надішлемо вашу заявку в адмінку. Оплата здійснюється при отриманні на відділенні Нової Пошти або кур'єру.</p>
    <button id="confirmBtn" class="confirm-btn">Підтвердити замовлення</button>
  </div>
</main>

<script>
const order = JSON.parse(localStorage.getItem('AUTOPARTS_ORDER')||'null');

function renderSummary(){
  const buyerInfo = document.getElementById('buyerInfo');
  const cartBox   = document.getElementById('cartItems');
  const totalBox  = document.getElementById('cartTotal');

  if(!order){
    if(buyerInfo) buyerInfo.innerHTML = 'Немає даних замовлення.';
    return;
  }

  // buyer / delivery block
  buyerInfo.innerHTML = `
    <div class="summary-row"><div>Ім'я:</div><div><strong>${order.name||''}</strong></div></div>
    <div class="summary-row"><div>Телефон:</div><div><strong>${order.phone||''}</strong></div></div>
    <div class="summary-row"><div>Адреса доставки:</div><div><strong>${order.address||''}</strong></div></div>
    <div class="summary-row"><div>Коментар / VIN:</div><div>${order.message||''}</div></div>
  `;

  // cart items + total
  let totalEur = 0;
  let itemsHtml = '';
  (order.cart||[]).forEach(i=>{
    const price = (i.price||0);
    totalEur += price;
    itemsHtml += `
      <div class="item-line">
        <div class="item-left">${i.brand||''} ${i.article||''}<br><span style="font-weight:400;font-size:13px;color:#475569">${i.title||''}</span></div>
        <div class="item-right">${price.toFixed ? price.toFixed(2) : price} €</div>
      </div>
    `;
  });
  cartBox.innerHTML = itemsHtml;

  totalBox.textContent = 'Разом (без доставки): ' + totalEur.toFixed(2) + ' €';
}

renderSummary();

document.getElementById('confirmBtn').addEventListener('click', async ()=>{
  if(!order){ alert('Немає даних'); return; }
  const fd = new FormData();
  fd.append('name', order.name||'');
  fd.append('phone', order.phone||'');
  fd.append('np', order.address||'');
  fd.append('message', order.message||'');
  fd.append('cart_json', JSON.stringify(order.cart||[]));
  fd.append('paymethod', 'cod');
  try{
    await fetch('backend/send.php', { method:'POST', body: fd });
  }catch(e){ console.warn('send failed', e); }
  localStorage.removeItem('AUTOPARTS_CART');
  localStorage.removeItem('AUTOPARTS_ORDER');
  window.location.href = 'thankyou.html';
});
</script>

</body>
</html>