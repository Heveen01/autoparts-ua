<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Оформлення замовлення — Autoparts‑UA</title>
<link rel="stylesheet" href="css/style.css">
<style>
/* simple centered card layout */
.container{max-width:980px;margin:24px auto;padding:0 16px;}
.card{background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:20px;}
.row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px;}
.col{flex:1;min-width:220px;}
label{display:block;font-weight:600;margin-bottom:6px;color:#1e293b}
.input, textarea{width:100%;padding:10px;border-radius:6px;border:1px solid #cbd5e1;font-size:14px}
.pay-method{border:1px solid #e6eef6;padding:12px;border-radius:8px;margin-bottom:12px}

.cod-extra {
  margin: 8px 0 16px 32px;
  background: #fffceb;
  border: 1px solid #d9be00;
  border-radius: 4px;
  padding: 10px 12px;
  font-size: 14px;
  line-height: 1.4;
  color: #333;
  max-width: 420px;
}
.cod-line { margin-bottom:4px; }
.cod-line:last-child { margin-bottom:0; }
.pay-option{display:flex;align-items:flex-start;gap:8px;margin:8px 0;padding:8px;border-radius:6px;cursor:pointer;font-size:16px;line-height:1.4;font-weight:500}
.pay-option input[type="radio"]{margin-top:3px}

.pay-option input{margin-right:8px}
.next-btn{display:inline-block;background:#ffc107;border:1px solid #000;padding:12px 20px;border-radius:6px;font-weight:700;cursor:pointer}
.small{font-size:13px;color:#475569;margin-top:8px}
.header-topline{background:#0a1a3a;color:#fff;border-bottom:3px solid #ffd000;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;}
.ukraine-banner{display:flex;align-items:center;gap:10px}
.ukraine-banner img{width:36px;height:24px;border-radius:3px;box-shadow:0 2px 8px rgba(0,0,0,.15)}
.navbar{background:#fff;border-bottom:1px solid #cbd5e1;padding:8px 16px;display:flex;gap:12px}

.cod-option {
  display:flex;
  align-items:center;
  gap:8px;
  margin:4px 0;
  font-size:15px;
  line-height:1.4;
  font-weight:500;
  color:#1e293b;
}
.cod-option input[type="radio"] {
  transform:scale(1.2);
}

</style>
  <script defer src="js/common-lang.js"></script>
</head>
<body>
<header>
  <div class="header-topline">
    <div style="display:flex;flex-direction:column">
      <div style="font-weight:700;font-size:18px">Autoparts‑UA</div>
      <div style="font-size:12px;color:#cbd5e1">Оформлення замовлення</div>
    </div>
    <div class="ukraine-banner"><img src="img/ukraine-flag.png" alt="UA"><div style="font-weight:700;color:#fff">Stand with Ukraine</div></div>
  </div>
  <nav class="navbar"><a href="index.html">Каталог</a><a href="delivery.html">Доставка і оплата</a><a href="contact.html">Контакти</a></nav>
</header>

<main class="container">
  <div class="card">
    <h2>Оформлення замовлення — крок 1</h2>
    <p class="small">Заповніть дані отримувача та оберіть спосіб оплати. Далі вас буде переадресовано на сторінку оплати або підтвердження.</p>

    <div style="margin-top:14px">
      <label for="fullname">Ваше ім'я та прізвище</label>
      <input id="fullname" class="input" placeholder="Ім'я Прізвище">
    </div>

    <div class="row">
      <div class="col">
        <label for="phone">Телефон (Viber / WhatsApp)</label>
        <input id="phone" class="input" placeholder="+380...">
      </div>
      <div class="col">
        <label for="address">Адреса доставки (місто / країна / відділення)</label>
        <input id="address" class="input" placeholder="м. Львів НП №5 / Wien AT / Praha CZ">
      </div>
    </div>

    <div style="margin-bottom:12px">
      <label for="message">VIN / Коментар (яка деталь потрібна)</label>
      <textarea id="message" class="input" rows="3" placeholder="VIN, диск BREMBO 09.7011.10"></textarea>
    </div>

    


<div class="pay-method">

  <!-- Спосіб 1: післяплата з передоплатою 40/100 -->
  <label class="pay-option">
    <input type="radio" name="pay" value="cod" id="pay_cod" checked>
    <span>Оплата при отриманні (Нова Пошта / Україна)</span>
  </label>

  <div class="cod-extra" id="codExtraBox">
    <div class="cod-option">
      <input type="radio" name="codtype" value="np">
      <span>Заберу у відділенні Нової Пошти — <strong>40 грн</strong> зараз</span>
    </div>
    <div class="cod-option">
      <input type="radio" name="codtype" value="courier">
      <span>Доставка кур’єром на адресу — <strong>100 грн</strong> зараз</span>
    </div>
    <div style="font-size:13px;color:#475569;margin-top:6px;line-height:1.4">
      Ви платите тільки 40 / 100 грн карткою зараз як підтвердження замовлення.
      Решту за запчастину ви оплачуєте при отриманні посилки.
    </div>
  </div>

  <!-- Спосіб 2: повна онлайн оплата -->
  <label class="pay-option">
    <input type="radio" name="pay" value="card" id="pay_card">
    <span>Оплата карткою / PayPal (ЄС і міжнародна оплата)</span>
  </label>

  <div class="cod-extra" id="onlineExtraBox">
    <div class="cod-option">
      <input type="radio" name="onlinedelivery" value="fullpay">
      <span>Повна оплата зараз (з доставкою +100 грн)</span>
    </div>
    <div style="font-size:13px;color:#475569;margin-top:6px;line-height:1.4">
      Ви сплачуєте всю суму за запчастини + 100 грн доставка.
      Після оплати ми відправляємо без післяплати.
    </div>
  </div>

</div>

<div style="margin-top:10px">



      <button id="toNext" class="next-btn">Продовжити</button>
    </div>

    <div class="small">⚠️ При виборі "Оплата карткою" ви будете переадресовані на захищений платіжний сервіс. Наш сайт не приймає і не зберігає дані картки.</div>
  </div>
</main>





<script>
document.addEventListener('DOMContentLoaded', () => {
  const codRadio   = document.getElementById('pay_cod');    // спосіб 1
  const cardRadio  = document.getElementById('pay_card');   // спосіб 2

  const codBox     = document.getElementById('codExtraBox');      // блок 40/100
  const onlineBox  = document.getElementById('onlineExtraBox');   // блок повної оплати

  const nextBtn    = document.getElementById('toNext');

  function refreshPayInfo() {
    if (codRadio.checked) {
      codBox.style.display = 'block';
      onlineBox.style.display = 'none';
    } else if (cardRadio.checked) {
      codBox.style.display = 'none';
      onlineBox.style.display = 'block';
    }
  }

  codRadio.addEventListener('change', refreshPayInfo);
  cardRadio.addEventListener('change', refreshPayInfo);
  refreshPayInfo();

  nextBtn.addEventListener('click', () => {
    const name    = document.getElementById('fullname').value.trim();
    const phone   = document.getElementById('phone').value.trim();
    const address = document.getElementById('address').value.trim();
    if(!name || !phone || !address){
      alert('Будь ласка, заповніть імʼя, телефон і адресу доставки.');
      return;
    }

    const msg = document.getElementById('message').value.trim();
    const pay = document.querySelector('input[name=pay]:checked').value;

    // зберігаємо дані замовлення
    const order = {
      name,
      phone,
      address,
      message: msg,
      cart: JSON.parse(localStorage.getItem('AUTOPARTS_CART')||'[]')
    };
    localStorage.setItem('AUTOPARTS_ORDER', JSON.stringify(order));

    if(pay === 'cod'){
      // спосіб 1: післяплата -> треба вибрати 40 або 100
      const codType = document.querySelector('input[name=codtype]:checked');
      if(!codType){
        alert('Виберіть тип доставки (40 грн відділення / 100 грн курʼєр)');
        return;
      }
      const sum = (codType.value === 'courier') ? 100 : 40;
      window.location.href = 'card.html?sum=' + encodeURIComponent(sum);
      return;
    }

    // спосіб 2: повна оплата
    const fullSel = document.querySelector('input[name=onlinedelivery]:checked');
    if(!fullSel){
      alert('Підтвердіть повну оплату (з доставкою +100 грн).');
      return;
    }
    // тут ми просто даємо маркування full=1
    window.location.href = 'card.html?full=1';
  });
});
</script>





<script>
// ===== ACCOUNT HISTORY INTEGRATION =====

// helpers
function readOrdersMap(){
  try {
    return JSON.parse(localStorage.getItem('AUTOPARTS_ORDERS_BY_PHONE')||'{}');
  } catch(e){
    return {};
  }
}
function writeOrdersMap(map){
  localStorage.setItem('AUTOPARTS_ORDERS_BY_PHONE', JSON.stringify(map));
}
function saveOrderToHistory(phone, orderData){
  const map = readOrdersMap();
  if(!map[phone]) map[phone] = [];
  map[phone].unshift(orderData);
  writeOrdersMap(map);
  localStorage.setItem('AUTOPARTS_LAST_PHONE', phone);
}
function calcCartTotalEUR(cart){
  let sum = 0;
  cart.forEach(item=>{
    const line = (parseFloat(item.price_eur)||0) * (parseInt(item.qty)||1);
    sum += line;
  });
  return +sum.toFixed(2);
}

// override submit handler if not already done
document.addEventListener('DOMContentLoaded', ()=>{
  const form = document.getElementById('checkoutForm');
  if(!form) return;

  form.addEventListener('submit', (e)=>{
    e.preventDefault();

    const nameInput    = document.getElementById('custName');
    const phoneInput   = document.getElementById('custPhone');
    const addrInput    = document.getElementById('custAddr');
    const msgInput     = document.getElementById('custMsg');

    const name    = nameInput.value.trim();
    const phone   = phoneInput.value.trim();
    const address = addrInput.value.trim();
    const msg     = msgInput.value.trim();
    const pay     = document.querySelector('input[name=paymethod]:checked')?.value;

    if(!name || !phone || !address || !pay){
      alert('Заповніть всі обов\\'язкові поля');
      return;
    }

    const cart = JSON.parse(localStorage.getItem('AUTOPARTS_CART')||'[]');
    if(cart.length===0){
      alert('Ваш кошик порожній');
      return;
    }

    // стандартний об'єкт замовлення
    const order = {
      name,
      phone,
      address,
      message: msg,
      cart
    };
    localStorage.setItem('AUTOPARTS_ORDER', JSON.stringify(order));

    const orderId = Date.now();
    const baseTotalEUR = calcCartTotalEUR(cart);

    let newOrderForHistory = {
      orderId,
      cart: cart.map(i=>({
        name: i.name,
        qty: i.qty,
        price_eur: i.price_eur
      })),
      totalEUR: baseTotalEUR,
      payMethod: pay,
      deliveryPrice: 0,
      prepayUAH: 0,
      status: 'Очікує обробки',
      createdAt: Date.now()
    };

    if(pay === 'cod'){
      const codType = document.querySelector('input[name=codtype]:checked');
      if(!codType){
        alert('Оберіть розмір передоплати (40 грн або 100 грн)');
        return;
      }
      const prepay = parseInt(codType.value)||0;
      newOrderForHistory.prepayUAH = prepay;

      saveOrderToHistory(phone, newOrderForHistory);
      // create share link and store for thankyou page
      try{ const shareLink = location.origin + '/account.html?phone=' + encodeURIComponent(phone); localStorage.setItem('AUTOPARTS_SHARE_LINK', shareLink);}catch(e){}
      window.location.href = 'cash.html';
      return;
    }

    if(pay === 'card'){
      newOrderForHistory.deliveryPrice = 100;

      saveOrderToHistory(phone, newOrderForHistory);
      try{ const shareLink = location.origin + '/account.html?phone=' + encodeURIComponent(phone); localStorage.setItem('AUTOPARTS_SHARE_LINK', shareLink);}catch(e){}
      window.location.href = 'payment.html';
      return;
    }
  }, {once:true});
});
</script>

</body>
</html>